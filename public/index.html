<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form id="login-form" style="display: block;">
        <input id="username" name="username" type="text" style="display: block; border: 2px red solid; border-radius: 10px; width: 200px; height: 35px; margin-bottom: 5px; "/>
        <input id="password"  name="password" type="password" style="display: block; border: 2px red solid; border-radius: 10px; width: 200px; height: 35px;  margin-bottom: 5px;"/>
        <input type="submit" value="submit" style="display: block; border: 2px red solid; border-radius: 10px; width: 100px; height: 35px; background-color: blue;  margin-bottom: 5px; margin-left: 50px; color:white; font-size: 20px;"/>
    </form>

    <!-- <div id="profileData"></div> -->
    <div id="profile" style="display: none;">
        <h1 id="displayUsername" style="color: blue; border: burlywood solid 2px; border-radius: 5px; "></h1>
        <h2 id="displayFirstName" style="color: blue; border: burlywood solid 2px; border-radius: 5px; "></h2>
        <h3 id="displayAge" style="color: blue; border: burlywood solid 2px; border-radius: 5px; "></h3>
    </div>

    <script>
        const form =document.getElementById('login-form');
        
        form.addEventListener("submit", async (e)=>{
            try{
                e.preventDefault();
                const username = e.target.elements.username.value;
                const password =e.target.elements.password.value;
            
                //generated by post man
                var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                var raw = JSON.stringify({username,password});

                var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
                };

                const loginResponse= await fetch("/users/login", requestOptions)
                .then(response => response.json())
                const {token} = loginResponse;

                if(token){
                    localStorage.setItem("token",token);
                    getProfile();
                }
                

                


            }
            catch(err){
                console.log(err);
            }
               
         });
            async function getProfile(){
                var profileHeaders = new Headers();
                profileHeaders.append("Authorization", localStorage.getItem("token"));

                var requestProfileOptions = {
                method: 'GET',
                headers: profileHeaders,
                redirect: 'follow'
                };

                const profile =await fetch("/users/profile", requestProfileOptions)
                .then(response => response.text());

                const profileJsonData =JSON.parse(profile);
                // document.getElementById('profileData').innerText =JSON.stringify(profile);
                document.getElementById('displayUsername').innerText = profileJsonData.username;
                document.getElementById('displayFirstName').innerText = 'welcome '+profileJsonData.firstname;
                document.getElementById('displayAge').innerText = profileJsonData.age;
                document.getElementById('login-form').style.display = "none";
                document.getElementById('profile').style.display = "block";
    }
        

    </script>    
</body>
</html>